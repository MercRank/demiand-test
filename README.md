# ü§ñ Telegram RAG –ë–æ—Ç –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∞—ç—Ä–æ–≥—Ä–∏–ª–µ–π

Production-ready —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –±–∞–∑–µ RAG (Retrieval Augmented Generation) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–º–Ω–æ–≥–æ Telegram-–±–æ—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Telegram –ë–æ—Ç** –Ω–∞ aiogram 3 —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- ‚úÖ **RAG —Å–∏—Å—Ç–µ–º–∞** —Å Qdrant –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π
- ‚úÖ **OpenAI GPT-4o-mini** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ **Streamlit –∞–¥–º–∏–Ω–∫–∞** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Excel/CSV –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Docker Compose** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–µ–ø–ª–æ—è
- ‚úÖ **Production-ready** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ legacy –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ core/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config.py   # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ logger.py   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ rag/            # RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ embeddings.py    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ vector_store.py  # –†–∞–±–æ—Ç–∞ —Å Qdrant
‚îÇ   ‚îî‚îÄ‚îÄ retriever.py     # RAG pipeline
‚îú‚îÄ‚îÄ bot/            # Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ handlers.py # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îî‚îÄ‚îÄ main.py     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ ingestion/      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ processor.py # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è Excel/CSV
‚îî‚îÄ‚îÄ admin/          # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    ‚îî‚îÄ‚îÄ app.py      # Streamlit UI
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- OpenAI API –∫–ª—é—á
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/MercRank/demiand-test.git
cd demiand-test
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```env
OPENAI_API_KEY=sk-proj-–≤–∞—à-–∫–ª—é—á-openai
TELEGRAM_BOT_TOKEN=–≤–∞—à-—Ç–æ–∫–µ–Ω-–±–æ—Ç–∞
```

### 3. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
docker compose up -d --build
```

**–ì–æ—Ç–æ–≤–æ!** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã:

- ü§ñ Telegram –±–æ—Ç ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ
- üìö –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî [http://localhost:8501](http://localhost:8501)
- üíæ Qdrant ‚Äî [http://localhost:6333/dashboard](http://localhost:6333/dashboard)

### 4. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: [http://localhost:8501](http://localhost:8501)
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ç–æ–≤–∞—Ä–∞—Ö
3. –ù–∞–∂–º–∏—Ç–µ "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª"
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã!**

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

Excel/CSV —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏:

- `–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `–ê—Ä—Ç–∏–∫—É–ª` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞—Ä—Ç–∏–∫—É–ª
- `–¢–∏–ø –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏` ‚Äî —Ç–∏–ø
- `–û–±—ä–µ–º, –ª` ‚Äî –æ–±—ä–µ–º –≤ –ª–∏—Ç—Ä–∞—Ö
- `–ö–æ–ª-–≤–æ –¢–≠–ù–æ–≤` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `–ú–æ—â–Ω–æ—Å—Ç—å, –í—Ç` ‚Äî –º–æ—â–Ω–æ—Å—Ç—å –≤ –≤–∞—Ç—Ç–∞—Ö
- `–ö–æ–ª-–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≥—Ä–∞–º–º
- `–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º` ‚Äî –ø–µ—Ä–µ—á–µ–Ω—å –ø—Ä–æ–≥—Ä–∞–º–º
- `–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π
- `–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è` ‚Äî —á—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–æ–º–ø–ª–µ–∫—Ç

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `.env`:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `OPENAI_API_KEY` | API –∫–ª—é—á OpenAI | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `OPENAI_MODEL` | –ú–æ–¥–µ–ª—å GPT | `gpt-4o-mini` |
| `OPENAI_EMBEDDING_MODEL` | –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ | `text-embedding-3-large` |
| `QDRANT_URL` | URL Qdrant | `http://localhost:6333` |
| `COLLECTION_NAME` | –ò–º—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ | `knowledge_base` |
| `RAG_TOP_K` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ | `5` |
| `RAG_SCORE_THRESHOLD` | –ü–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ | `0.7` |

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ Docker:

### 1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# venv\Scripts\activate   # Windows
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Qdrant

```bash
docker run -p 6333:6333 qdrant/qdrant
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
```bash
streamlit run src/admin/app.py
```

**Telegram –±–æ—Ç:**
```bash
python -m src.bot.main
```

## üê≥ Docker –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
docker compose restart bot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–æ—Ç–∞
docker compose logs -f bot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∞–¥–º–∏–Ω–∫–∏
docker compose logs -f admin

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose down

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è volumes)
docker compose down -v
```

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

–ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –≤ Telegram:

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- –õ—é–±–æ–π –≤–æ–ø—Ä–æ—Å ‚Äî –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:
- "–ü–æ–∫–∞–∂–∏ –º–æ–¥–µ–ª–∏ —Å –¥–≤—É–º—è –¢–≠–ù–∞–º–∏"
- "–ö–∞–∫–æ–π –æ–±—ä–µ–º —É –º–æ–¥–µ–ª–∏ AF-1234?"
- "–°—Ä–∞–≤–Ω–∏ –º–æ–¥–µ–ª–∏ –ø–æ –º–æ—â–Ω–æ—Å—Ç–∏"
- "–ö–∞–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –µ—Å—Ç—å –≤ –º–æ–¥–µ–ª–∏ XYZ?"

## üîí Production Best Practices

‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ:

- Multi-stage Docker build –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
- Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π restart –ø—Ä–∏ —Å–±–æ—è—Ö
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- –ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ Docker networks
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- Graceful shutdown
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Typing hints –≤–µ–∑–¥–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üÜò Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs bot`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Qdrant –∑–∞–ø—É—â–µ–Ω: `docker compose ps`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –∞–¥–º–∏–Ω–∫–µ

### –û—à–∏–±–∫–∞ OpenAI API

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å `OPENAI_API_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –µ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API

### Qdrant –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 6333 —Å–≤–æ–±–æ–¥–µ–Ω: `lsof -i :6333`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs qdrant`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å volume: `docker compose down -v && docker compose up -d`

## üìö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11** ‚Äî —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **aiogram 3.13** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram –±–æ—Ç–æ–≤
- **OpenAI API** ‚Äî GPT-4o-mini –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- **Qdrant** ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Streamlit** ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∫–∏
- **Docker & Docker Compose** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **pandas** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ Excel/CSV

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `src/core/` ‚Äî –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∫–æ–Ω—Ñ–∏–≥, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `src/rag/` ‚Äî RAG –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –ø–æ–∏—Å–∫, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- `src/bot/` ‚Äî Telegram –±–æ—Ç
- `src/ingestion/` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `src/admin/` ‚Äî Streamlit –∞–¥–º–∏–Ω–∫–∞
